---
# Integration test for bootstrap playbook
# Tests that common, security, and updates roles work together
- name: Bootstrap Integration Test
  hosts: all
  become: true
  gather_facts: true

  vars:
    # Common role vars
    system_timezone: "Europe/Amsterdam"
    system_hostname: "test-server"
    common_packages:
      - vim
      - htop
      - curl
      - wget
      - git

    # Security role vars
    ssh_permit_root_login: "no"
    ssh_password_authentication: "no"
    ssh_pubkey_authentication: "yes"
    ssh_max_auth_tries: 3
    ssh_x11_forwarding: "no"
    ufw_enabled: true
    ufw_default_incoming: "deny"
    ufw_default_outgoing: "allow"
    fail2ban_enabled: true

  pre_tasks:
    - name: Update apt cache
      apt:
        update_cache: yes
        cache_valid_time: 3600

    - name: Display server information
      debug:
        msg: "Bootstrapping {{ inventory_hostname }} ({{ ansible_distribution }} {{ ansible_distribution_version }})"

  roles:
    - role: common
    - role: security
    - role: updates

  post_tasks:
    - name: Display completion message
      debug:
        msg: "Bootstrap completed successfully for {{ inventory_hostname }}"
