---
- name: Verify common configuration
  hosts: all
  become: true
  gather_facts: false

  tasks:
    # Timezone Tests
    - name: Verify timezone is set correctly
      command: timedatectl show --property=Timezone --value
      register: timezone_check
      changed_when: false
      failed_when: "'Europe/Amsterdam' not in timezone_check.stdout"

    # Package Installation Tests
    - name: Verify common packages are installed
      package:
        name: "{{ item }}"
        state: present
      check_mode: yes
      register: package_check
      failed_when: package_check.changed
      loop:
        - vim
        - htop
        - curl
        - wget
        - git
        - net-tools
        - tree
        - unzip

    # Hostname Configuration Tests
    - name: Verify /etc/hostname exists
      stat:
        path: /etc/hostname
      register: hostname_file
      failed_when: not hostname_file.stat.exists

    - name: Verify hostname is set
      command: hostname
      register: hostname_check
      changed_when: false
      failed_when: hostname_check.stdout | length == 0

    - name: Verify hostname is in /etc/hosts
      command: grep -q "$(hostname)" /etc/hosts
      register: hosts_check
      changed_when: false
      failed_when: hosts_check.rc != 0

    # Locale Tests
    - name: Verify locale is configured
      command: locale
      register: locale_check
      changed_when: false
      failed_when: locale_check.rc != 0

    - name: Display verification summary
      debug:
        msg: "All common role verification tests passed successfully!"
